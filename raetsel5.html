<!DOCTYPE html>
        <html lang="de">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>RÃ¤tsel 5 â€“ Tetris</title>
        <style>
            body {
                margin: 0;
                background: linear-gradient(120deg, #43c6ac 0%, #f8ffae 100%);
                font-family: Arial, Helvetica, sans-serif;
                color: #222;
                text-align: center;
            }
            #gameContainer {
                max-width: 900px;
                margin: 20px auto;
            }
            canvas {
                background: #1b1b1b;
                border: 4px solid #43c6ac;
                border-radius: 20px;
                box-shadow: 0 20px 50px #43c6ac22;
                margin-top: 18px;
            }
            #ui {
                margin-top: 10px;
                font-size: 18px;
            }
            #winOverlay {
                position: fixed;
                inset: 0;
                background: rgba(67,198,172,0.95);
                display: none;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                z-index: 10;
            }
            #winOverlay h1 { font-size: 52px; margin-bottom: 20px; color: #222;}
            #codeBox {
                font-size: 56px;
                padding: 30px 60px;
                background: #f8ffae;
                color: #222;
                border-radius: 20px;
                margin-bottom: 15px;
                font-family: 'Courier New', monospace;
                box-shadow: 0 2px 12px #43c6ac22;
            }
            button {
                padding: 10px 20px;
                font-size: 18px;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                background: #43c6ac;
                color: #222;
                font-weight: bold;
                margin-top: 10px;
                box-shadow: 0 2px 8px #43c6ac22;
            }
            button:hover {
                background: #f8ffae;
                color: #111;
            }
        </style>
        </head>
        <body>
        <div id="gameContainer">
            <h1>Tetris â€“ 20 Reihen fÃ¼r den Code!</h1>
            <p>A/D = Links/Rechts &nbsp;|&nbsp; W = Drehen &nbsp;|&nbsp; S = Schneller &nbsp;|&nbsp; Leertaste: Sofort fallen</p>
            <canvas id="game" width="320" height="640"></canvas>
            <div id="ui">
                Reihen: <span id="linesDisplay">0</span> / 20 &nbsp;|&nbsp;
                Punkte: <span id="scoreDisplay">0</span>
            </div>
        </div>
        <div id="winOverlay">
            <h1>ðŸŽ‰ Geschafft!</h1>
            <div id="codeBox">9</div>
            <p>Kopiere den Code fÃ¼r deine PDF.</p>
            <button onclick="location.reload()">Nochmal spielen</button>
        </div>
        <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const linesDisplay = document.getElementById('linesDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const winOverlay = document.getElementById('winOverlay');

        const COLS = 10, ROWS = 20, BLOCK = 32;
        const COLORS = [
            "#43c6ac", // I
            "#f8ffae", // O
            "#ffb347", // T
            "#4ecdc4", // S
            "#ff6b6b", // Z
            "#5c9ded", // J
            "#b5651d"  // L
        ];
        const BG_COLOR = "#1b1b1b";
        const GRID_COLOR = "#222";
        const GHOST_COLOR = "#43c6ac55";

        const SHAPES = [
            [[1,1,1,1]],
            [[1,1],[1,1]],
            [[0,1,0],[1,1,1]],
            [[0,1,1],[1,1,0]],
            [[1,1,0],[0,1,1]],
            [[1,0,0],[1,1,1]],
            [[0,0,1],[1,1,1]]
        ];

        let board = [];
        let current, next, x, y, rot;
        let dropTimer = 0, dropInterval = 400;
        let lines = 0, score = 0, gameOver = false;

        function resetBoard() {
            board = [];
            for(let r=0;r<ROWS;r++) {
                board[r] = Array(COLS).fill(-1);
            }
        }

        function randomPiece() {
            const id = Math.floor(Math.random()*SHAPES.length);
            return {id, shape: SHAPES[id]};
        }

        function spawn() {
            current = next || randomPiece();
            next = randomPiece();
            rot = 0;
            x = 3;
            y = 0;
            if(collide(x,y,current.shape,rot)) {
                gameOver = true;
                setTimeout(()=>showWin(false),500);
            }
        }

        function rotate(shape, times) {
            let s = shape;
            for(let t=0;t<times;t++) {
                s = s[0].map((_,i)=>s.map(r=>r[i])).reverse();
            }
            return s;
        }

        function collide(nx,ny,shape,rot) {
            const s = rotate(shape,rot);
            for(let r=0;r<s.length;r++) {
                for(let c=0;c<s[0].length;c++) {
                    if(s[r][c]) {
                        let px = nx+c, py = ny+r;
                        if(px<0||px>=COLS||py>=ROWS) return true;
                        if(py>=0 && board[py][px]>=0) return true;
                    }
                }
            }
            return false;
        }

        function merge() {
            const s = rotate(current.shape,rot);
            for(let r=0;r<s.length;r++) {
                for(let c=0;c<s[0].length;c++) {
                    if(s[r][c]) {
                        let px = x+c, py = y+r;
                        if(py>=0) board[py][px]=current.id;
                    }
                }
            }
        }

        function clearLines() {
            let cleared = 0;
            for(let r=ROWS-1;r>=0;r--) {
                if(board[r].every(v=>v>=0)) {
                    board.splice(r,1);
                    board.unshift(Array(COLS).fill(-1));
                    cleared++;
                    r++;
                }
            }
            if(cleared>0) {
                lines += cleared;
                score += [0,40,100,300,1200][cleared];
                linesDisplay.textContent = lines;
                scoreDisplay.textContent = score;
                if(lines>=20) setTimeout(()=>showWin(true),400);
            }
        }

        function hardDrop() {
            while(!collide(x,y+1,current.shape,rot)) y++;
            step();
        }

        function drawBlock(x0,y0,id,alpha=1) {
            ctx.globalAlpha = alpha;
            ctx.fillStyle = COLORS[id];
            ctx.fillRect(x0,y0,BLOCK,BLOCK);
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 2;
            ctx.strokeRect(x0+2,y0+2,BLOCK-4,BLOCK-4);
            ctx.globalAlpha = 1;
        }

        function draw() {
            ctx.fillStyle = BG_COLOR;
            ctx.fillRect(0,0,canvas.width,canvas.height);

            for(let r=0;r<ROWS;r++) {
                for(let c=0;c<COLS;c++) {
                    ctx.strokeStyle = GRID_COLOR;
                    ctx.lineWidth = 1;
                    ctx.strokeRect(c*BLOCK,r*BLOCK,BLOCK,BLOCK);
                    if(board[r][c]>=0) drawBlock(c*BLOCK,r*BLOCK,board[r][c]);
                }
            }

            let ghostY = y;
            while(!collide(x,ghostY+1,current.shape,rot)) ghostY++;
            const s = rotate(current.shape,rot);
            for(let r=0;r<s.length;r++) {
                for(let c=0;c<s[0].length;c++) {
                    if(s[r][c]) drawBlock((x+c)*BLOCK,(ghostY+r)*BLOCK,current.id,0.25);
                }
            }

            for(let r=0;r<s.length;r++) {
                for(let c=0;c<s[0].length;c++) {
                    if(s[r][c]) drawBlock((x+c)*BLOCK,(y+r)*BLOCK,current.id);
                }
            }
        }

        function step() {
            if(!collide(x,y+1,current.shape,rot)) {
                y++;
            } else {
                merge();
                clearLines();
                spawn();
            }
        }

        function showWin(success) {
            winOverlay.style.display = "flex";
            document.getElementById('codeBox').textContent = success ? "9" : "GAME OVER";
        }

        function gameLoop(ts) {
            if(gameOver) return;
            draw();
            if(Date.now()-dropTimer>dropInterval) {
                step();
                dropTimer = Date.now();
            }
            requestAnimationFrame(gameLoop);
        }

        // WASD Steuerung
        document.addEventListener('keydown',e=>{
            if(gameOver) return;
            if(e.code==="KeyA" && !collide(x-1,y,current.shape,rot)) x--;
            if(e.code==="KeyD" && !collide(x+1,y,current.shape,rot)) x++;
            if(e.code==="KeyW") {
                let newRot = (rot+1)%4;
                if(!collide(x,y,current.shape,newRot)) rot=newRot;
            }
            if(e.code==="KeyS" && !collide(x,y+1,current.shape,rot)) y++;
            if(e.code==="Space") hardDrop();
        });

        resetBoard();
        lines = 0; score = 0; gameOver = false;
        linesDisplay.textContent = lines;
        scoreDisplay.textContent = score;
        spawn();
        dropTimer = Date.now();
        gameLoop();
        </script>
        </body>
        </html>